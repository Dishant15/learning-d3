<!DOCTYPE html>
<html>
<head>
	<title>Data on Globe with D3</title>

	<style type="text/css">

		.container {
			width: 1500px;
			margin: 10px auto;
			padding: 0px;
		}

		#chart {
			background: steelblue;
		}

		h3 {
			text-align: center;
			color: white;
		}

		circle {
			stroke: grey;
			fill: red;
			opacity: 0.5;
		}

		#tooltip {
			position: absolute;
			background: white;
			border: 1px solid grey;
			color : steelblue;
			opacity: 0;
			padding: 10px;
			text-align: center;
			border-radius: 5px;
		}

		text {fill: black}
	</style>
</head>
<body>

<div class='container'>
	<h3>Data plot on global map</h3>
	<svg id='chart'> </svg>
	<div id="tooltip">
	</div>
</div>

<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script type="text/javascript">

		var data_url = 'https://raw.githubusercontent.com/FreeCodeCamp/ProjectReferenceData/master/meteorite-strike-data.json';
		var map_url = "https://unpkg.com/world-atlas@1/world/110m.json"

		var margin = {top : 0, bottom: 0, right: 0, left: 0},
			   width = 1500 - margin.left - margin.right,
			   height = 1000 - margin.top - margin.bottom;
			   
	    var vis = d3.select("#chart")
	      	.attr("width", width + margin.left + margin.right)
	      	.attr("height", height + margin.top + margin.bottom)
	      .append("g")

	    var projection = d3.geoMercator()
                   .scale(200)
                  .translate( [width / 2, height / 1.65]);

		var path = d3.geoPath().projection(projection);

		var scale = d3.scaleLinear().range([2, 25])

	    d3.queue()
		    .defer(d3.json, data_url)
		    .defer(d3.json, map_url)
		    .await(ready);

		function ready(error, data, counry_data) {
			// console.log('data',d3.min(data.features, d => Number(d.properties.mass)))

			scale.domain( [d3.min(data.features, d => Number(d.properties.mass)), d3.max(data.features, d => Number(d.properties.mass))] )

			vis.append("g").attr("class", "map").selectAll("path")
		      .data(topojson.feature(counry_data, counry_data.objects.countries).features) // Bind TopoJSON data elements
		    .enter().append("path")
		      .attr("d", path)
		      .style("fill", "white")
		      .style("stroke", "black")

		   	// add meteorite circles on the map
		    vis.append("g").attr("class", "data").selectAll("circle")
		    	.data(data.features)
		   	.enter().append("circle")
		   		.attr("r", d => scale(Number(d.properties.mass)))
		   		.attr("cx", d =>  d.geometry ? projection(d.geometry.coordinates)[0] : -1000 )
		   		.attr("cy", d => d.geometry ? projection(d.geometry.coordinates)[1] : -1000 )
		}
</script>
</body>
</html>